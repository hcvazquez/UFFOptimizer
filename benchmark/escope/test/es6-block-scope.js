'use strict';

var _chai = require('chai');

var _esprima = require('../third_party/esprima');

var _ = require('..');

describe('ES6 block scope', function () {
    it('let is materialized in ES6 block scope#1', function () {
        var ast = (0, _esprima.parse)('\n            {\n                let i = 20;\n                i;\n            }\n        ');

        var scopeManager = (0, _.analyze)(ast, { ecmaVersion: 6 });
        (0, _chai.expect)(scopeManager.scopes).to.have.length(2); // Program and BlcokStatement scope.

        var scope = scopeManager.scopes[0];
        (0, _chai.expect)(scope.type).to.be.equal('global');
        (0, _chai.expect)(scope.variables).to.have.length(0); // No variable in Program scope.

        scope = scopeManager.scopes[1];
        (0, _chai.expect)(scope.type).to.be.equal('block');
        (0, _chai.expect)(scope.variables).to.have.length(1); // `i` in block scope.
        (0, _chai.expect)(scope.variables[0].name).to.be.equal('i');
        (0, _chai.expect)(scope.references).to.have.length(2);
        (0, _chai.expect)(scope.references[0].identifier.name).to.be.equal('i');
        (0, _chai.expect)(scope.references[1].identifier.name).to.be.equal('i');
    });

    it('let is materialized in ES6 block scope#2', function () {
        var ast = (0, _esprima.parse)('\n            {\n                let i = 20;\n                var i = 20;\n                i;\n            }\n        ');

        var scopeManager = (0, _.analyze)(ast, { ecmaVersion: 6 });
        (0, _chai.expect)(scopeManager.scopes).to.have.length(2); // Program and BlcokStatement scope.

        var scope = scopeManager.scopes[0];
        (0, _chai.expect)(scope.type).to.be.equal('global');
        (0, _chai.expect)(scope.variables).to.have.length(1); // No variable in Program scope.
        (0, _chai.expect)(scope.variables[0].name).to.be.equal('i');

        scope = scopeManager.scopes[1];
        (0, _chai.expect)(scope.type).to.be.equal('block');
        (0, _chai.expect)(scope.variables).to.have.length(1); // `i` in block scope.
        (0, _chai.expect)(scope.variables[0].name).to.be.equal('i');
        (0, _chai.expect)(scope.references).to.have.length(3);
        (0, _chai.expect)(scope.references[0].identifier.name).to.be.equal('i');
        (0, _chai.expect)(scope.references[1].identifier.name).to.be.equal('i');
        (0, _chai.expect)(scope.references[2].identifier.name).to.be.equal('i');
    });

    it('function delaration is materialized in ES6 block scope', function () {
        var ast = (0, _esprima.parse)('\n            {\n                function test() {\n                }\n                test();\n            }\n        ');

        var scopeManager = (0, _.analyze)(ast, { ecmaVersion: 6 });
        (0, _chai.expect)(scopeManager.scopes).to.have.length(3);

        var scope = scopeManager.scopes[0];
        (0, _chai.expect)(scope.type).to.be.equal('global');
        (0, _chai.expect)(scope.variables).to.have.length(0);

        scope = scopeManager.scopes[1];
        (0, _chai.expect)(scope.type).to.be.equal('block');
        (0, _chai.expect)(scope.variables).to.have.length(1);
        (0, _chai.expect)(scope.variables[0].name).to.be.equal('test');
        (0, _chai.expect)(scope.references).to.have.length(1);
        (0, _chai.expect)(scope.references[0].identifier.name).to.be.equal('test');

        scope = scopeManager.scopes[2];
        (0, _chai.expect)(scope.type).to.be.equal('function');
        (0, _chai.expect)(scope.variables).to.have.length(1);
        (0, _chai.expect)(scope.variables[0].name).to.be.equal('arguments');
        (0, _chai.expect)(scope.references).to.have.length(0);
    });

    it('let is not hoistable#1', function () {
        var ast = (0, _esprima.parse)('\n            var i = 42; (1)\n            {\n                i;  // (2) ReferenceError at runtime.\n                let i = 20;  // (2)\n                i;  // (2)\n            }\n        ');

        var scopeManager = (0, _.analyze)(ast, { ecmaVersion: 6 });
        (0, _chai.expect)(scopeManager.scopes).to.have.length(2);

        var globalScope = scopeManager.scopes[0];
        (0, _chai.expect)(globalScope.type).to.be.equal('global');
        (0, _chai.expect)(globalScope.variables).to.have.length(1);
        (0, _chai.expect)(globalScope.variables[0].name).to.be.equal('i');
        (0, _chai.expect)(globalScope.references).to.have.length(1);

        var scope = scopeManager.scopes[1];
        (0, _chai.expect)(scope.type).to.be.equal('block');
        (0, _chai.expect)(scope.variables).to.have.length(1);
        (0, _chai.expect)(scope.variables[0].name).to.be.equal('i');
        (0, _chai.expect)(scope.references).to.have.length(3);
        (0, _chai.expect)(scope.references[0].resolved).to.be.equal(scope.variables[0]);
        (0, _chai.expect)(scope.references[1].resolved).to.be.equal(scope.variables[0]);
        (0, _chai.expect)(scope.references[2].resolved).to.be.equal(scope.variables[0]);
    });

    it('let is not hoistable#2', function () {
        var ast = (0, _esprima.parse)('\n            (function () {\n                var i = 42; // (1)\n                i;  // (1)\n                {\n                    i;  // (3)\n                    {\n                        i;  // (2)\n                        let i = 20;  // (2)\n                        i;  // (2)\n                    }\n                    let i = 30;  // (3)\n                    i;  // (3)\n                }\n                i;  // (1)\n            }());\n        ');

        var scopeManager = (0, _.analyze)(ast, { ecmaVersion: 6 });
        (0, _chai.expect)(scopeManager.scopes).to.have.length(4);

        var globalScope = scopeManager.scopes[0];
        (0, _chai.expect)(globalScope.type).to.be.equal('global');
        (0, _chai.expect)(globalScope.variables).to.have.length(0);
        (0, _chai.expect)(globalScope.references).to.have.length(0);

        var scope = scopeManager.scopes[1];
        (0, _chai.expect)(scope.type).to.be.equal('function');
        (0, _chai.expect)(scope.variables).to.have.length(2);
        (0, _chai.expect)(scope.variables[0].name).to.be.equal('arguments');
        (0, _chai.expect)(scope.variables[1].name).to.be.equal('i');
        var v1 = scope.variables[1];
        (0, _chai.expect)(scope.references).to.have.length(3);
        (0, _chai.expect)(scope.references[0].resolved).to.be.equal(v1);
        (0, _chai.expect)(scope.references[1].resolved).to.be.equal(v1);
        (0, _chai.expect)(scope.references[2].resolved).to.be.equal(v1);

        scope = scopeManager.scopes[2];
        (0, _chai.expect)(scope.type).to.be.equal('block');
        (0, _chai.expect)(scope.variables).to.have.length(1);
        (0, _chai.expect)(scope.variables[0].name).to.be.equal('i');
        var v3 = scope.variables[0];
        (0, _chai.expect)(scope.references).to.have.length(3);
        (0, _chai.expect)(scope.references[0].resolved).to.be.equal(v3);
        (0, _chai.expect)(scope.references[1].resolved).to.be.equal(v3);
        (0, _chai.expect)(scope.references[2].resolved).to.be.equal(v3);

        scope = scopeManager.scopes[3];
        (0, _chai.expect)(scope.type).to.be.equal('block');
        (0, _chai.expect)(scope.variables).to.have.length(1);
        (0, _chai.expect)(scope.variables[0].name).to.be.equal('i');
        var v2 = scope.variables[0];
        (0, _chai.expect)(scope.references).to.have.length(3);
        (0, _chai.expect)(scope.references[0].resolved).to.be.equal(v2);
        (0, _chai.expect)(scope.references[1].resolved).to.be.equal(v2);
        (0, _chai.expect)(scope.references[2].resolved).to.be.equal(v2);
    });
});

// vim: set sw=4 ts=4 et tw=80 :
// -*- coding: utf-8 -*-
//  Copyright (C) 2014 Yusuke Suzuki <utatane.tea@gmail.com>
//
//  Redistribution and use in source and binary forms, with or without
//  modification, are permitted provided that the following conditions are met:
//
//    * Redistributions of source code must retain the above copyright
//      notice, this list of conditions and the following disclaimer.
//    * Redistributions in binary form must reproduce the above copyright
//      notice, this list of conditions and the following disclaimer in the
//      documentation and/or other materials provided with the distribution.
//
//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
//  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
//  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
//  ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY
//  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
//  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
//  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
//  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
//  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
//  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVzNi1ibG9jay1zY29wZS5qcyJdLCJuYW1lcyI6WyJkZXNjcmliZSIsIml0IiwiYXN0Iiwic2NvcGVNYW5hZ2VyIiwiZWNtYVZlcnNpb24iLCJzY29wZXMiLCJ0byIsImhhdmUiLCJsZW5ndGgiLCJzY29wZSIsInR5cGUiLCJiZSIsImVxdWFsIiwidmFyaWFibGVzIiwibmFtZSIsInJlZmVyZW5jZXMiLCJpZGVudGlmaWVyIiwiZ2xvYmFsU2NvcGUiLCJyZXNvbHZlZCIsInYxIiwidjMiLCJ2MiJdLCJtYXBwaW5ncyI6Ijs7QUF1QkE7O0FBQ0E7O0FBQ0E7O0FBRUFBLFNBQVMsaUJBQVQsRUFBNEIsWUFBVztBQUNuQ0MsT0FBRywwQ0FBSCxFQUErQyxZQUFXO0FBQ3RELFlBQU1DLE1BQU0sZ0hBQVo7O0FBT0EsWUFBTUMsZUFBZSxlQUFRRCxHQUFSLEVBQWEsRUFBQ0UsYUFBYSxDQUFkLEVBQWIsQ0FBckI7QUFDQSwwQkFBT0QsYUFBYUUsTUFBcEIsRUFBNEJDLEVBQTVCLENBQStCQyxJQUEvQixDQUFvQ0MsTUFBcEMsQ0FBMkMsQ0FBM0MsRUFUc0QsQ0FTTjs7QUFFaEQsWUFBSUMsUUFBUU4sYUFBYUUsTUFBYixDQUFvQixDQUFwQixDQUFaO0FBQ0EsMEJBQU9JLE1BQU1DLElBQWIsRUFBbUJKLEVBQW5CLENBQXNCSyxFQUF0QixDQUF5QkMsS0FBekIsQ0FBK0IsUUFBL0I7QUFDQSwwQkFBT0gsTUFBTUksU0FBYixFQUF3QlAsRUFBeEIsQ0FBMkJDLElBQTNCLENBQWdDQyxNQUFoQyxDQUF1QyxDQUF2QyxFQWJzRCxDQWFWOztBQUU1Q0MsZ0JBQVFOLGFBQWFFLE1BQWIsQ0FBb0IsQ0FBcEIsQ0FBUjtBQUNBLDBCQUFPSSxNQUFNQyxJQUFiLEVBQW1CSixFQUFuQixDQUFzQkssRUFBdEIsQ0FBeUJDLEtBQXpCLENBQStCLE9BQS9CO0FBQ0EsMEJBQU9ILE1BQU1JLFNBQWIsRUFBd0JQLEVBQXhCLENBQTJCQyxJQUEzQixDQUFnQ0MsTUFBaEMsQ0FBdUMs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SCxNQUFNSSxTQUFiLEVBQXdCUCxFQUF4QixDQUEyQkMsSUFBM0IsQ0FBZ0NDLE1BQWhDLENBQXVDLENBQXZDO0FBQ0EsMEJBQU9DLE1BQU1JLFNBQU4sQ0FBZ0IsQ0FBaEIsRUFBbUJDLElBQTFCLEVBQWdDUixFQUFoQyxDQUFtQ0ssRUFBbkMsQ0FBc0NDLEtBQXRDLENBQTRDLEdBQTVDO0FBQ0EsWUFBTVMsS0FBS1osTUFBTUksU0FBTixDQUFnQixDQUFoQixDQUFYO0FBQ0EsMEJBQU9KLE1BQU1NLFVBQWIsRUFBeUJULEVBQXpCLENBQTRCQyxJQUE1QixDQUFpQ0MsTUFBakMsQ0FBd0MsQ0FBeEM7QUFDQSwwQkFBT0MsTUFBTU0sVUFBTixDQUFpQixDQUFqQixFQUFvQkcsUUFBM0IsRUFBcUNaLEVBQXJDLENBQXdDSyxFQUF4QyxDQUEyQ0MsS0FBM0MsQ0FBaURTLEVBQWpEO0FBQ0EsMEJBQU9aLE1BQU1NLFVBQU4sQ0FBaUIsQ0FBakIsRUFBb0JHLFFBQTNCLEVBQXFDWixFQUFyQyxDQUF3Q0ssRUFBeEMsQ0FBMkNDLEtBQTNDLENBQWlEUyxFQUFqRDtBQUNBLDBCQUFPWixNQUFNTSxVQUFOLENBQWlCLENBQWpCLEVBQW9CRyxRQUEzQixFQUFxQ1osRUFBckMsQ0FBd0NLLEVBQXhDLENBQTJDQyxLQUEzQyxDQUFpRFMsRUFBakQ7QUFDSCxLQXpERDtBQTBESCxDQXpLRDs7QUEyS0E7QUF0TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZXM2LWJsb2NrLXNjb3BlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gLSotIGNvZGluZzogdXRmLTggLSotXG4vLyAgQ29weXJpZ2h0IChDKSAyMDE0IFl1c3VrZSBTdXp1a2kgPHV0YXRhbmUudGVhQGdtYWlsLmNvbT5cbi8vXG4vLyAgUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0XG4vLyAgbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6XG4vL1xuLy8gICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodFxuLy8gICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuXG4vLyAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0XG4vLyAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGVcbi8vICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi5cbi8vXG4vLyAgVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyBcIkFTIElTXCJcbi8vICBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFXG4vLyAgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0Vcbi8vICBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgPENPUFlSSUdIVCBIT0xERVI+IEJFIExJQUJMRSBGT1IgQU5ZXG4vLyAgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVNcbi8vICAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7XG4vLyAgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EXG4vLyAgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlRcbi8vICAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0Zcbi8vICBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuXG5pbXBvcnQgeyBleHBlY3QgfSBmcm9tICdjaGFpJztcbmltcG9ydCB7IHBhcnNlIH0gZnJvbSAnLi4vdGhpcmRfcGFydHkvZXNwcmltYSc7XG5pbXBvcnQgeyBhbmFseXplIH0gZnJvbSAnLi4nO1xuXG5kZXNjcmliZSgnRVM2IGJsb2NrIHNjb3BlJywgZnVuY3Rpb24oKSB7XG4gICAgaXQoJ2xldCBpcyBtYXRlcmlhbGl6ZWQgaW4gRVM2IGJsb2NrIHNjb3BlIzEnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3QgYXN0ID0gcGFyc2UoYFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGxldCBpID0gMjA7XG4gICAgICAgICAgICAgICAgaTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgYCk7XG5cbiAgICAgICAgY29uc3Qgc2NvcGVNYW5hZ2VyID0gYW5hbHl6ZShhc3QsIHtlY21hVmVyc2lvbjogNn0pO1xuICAgICAgICBleHBlY3Qoc2NvcGVNYW5hZ2VyLnNjb3BlcykudG8uaGF2ZS5sZW5ndGgoMik7ICAvLyBQcm9ncmFtIGFuZCBCbGNva1N0YXRlbWVudCBzY29wZS5cblxuICAgICAgICBsZXQgc2NvcGUgPSBzY29wZU1hbmFnZXIuc2NvcGVzWzBdO1xuICAgICAgICBleHBlY3Qoc2NvcGUudHlwZSkudG8uYmUuZXF1YWwoJ2dsb2JhbCcpO1xuICAgICAgICBleHBlY3Qoc2NvcGUudmFyaWFibGVzKS50by5oYXZlLmxlbmd0aCgwKTsgIC8vIE5vIHZhcmlhYmxlIGluIFByb2dyYW0gc2NvcGUuXG5cbiAgICAgICAgc2NvcGUgPSBzY29wZU1hbmFnZXIuc2NvcGVzWzFdO1xuICAgICAgICBleHBlY3Qoc2NvcGUudHlwZSkudG8uYmUuZXF1YWwoJ2Jsb2NrJyk7XG4gICAgICAgIGV4cGVjdChzY29wZS52YXJpYWJsZXMpLnRvLmhhdmUubGVuZ3RoKDEpOyAgLy8gYGlgIGluIGJsb2NrIHNjb3BlLlxuICAgICAgICBleHBlY3Qoc2NvcGUudmFyaWFibGVzWzBdLm5hbWUpLnRvLmJlLmVxdWFsKCdpJyk7XG4gICAgICAgIGV4cGVjdChzY29wZS5yZWZlcmVuY2VzKS50by5oYXZlLmxlbmd0aCgyKTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnJlZmVyZW5jZXNbMF0uaWRlbnRpZmllci5uYW1lKS50by5iZS5lcXVhbCgnaScpO1xuICAgICAgICBleHBlY3Qoc2NvcGUucmVmZXJlbmNlc1sxXS5pZGVudGlmaWVyLm5hbWUpLnRvLmJlLmVxdWFsKCdpJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnbGV0IGlzIG1hdGVyaWFsaXplZCBpbiBFUzYgYmxvY2sgc2NvcGUjMicsIGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25zdCBhc3QgPSBwYXJzZShgXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbGV0IGkgPSAyMDtcbiAgICAgICAgICAgICAgICB2YXIgaSA9IDIwO1xuICAgICAgICAgICAgICAgIGk7XG4gICAgICAgICAgICB9XG4gICAgICAgIGApO1xuXG4gICAgICAgIGNvbnN0IHNjb3BlTWFuYWdlciA9IGFuYWx5emUoYXN0LCB7ZWNtYVZlcnNpb246IDZ9KTtcbiAgICAgICAgZXhwZWN0KHNjb3BlTWFuYWdlci5zY29wZXMpLnRvLmhhdmUubGVuZ3RoKDIpOyAgLy8gUHJvZ3JhbSBhbmQgQmxjb2tTdGF0ZW1lbnQgc2NvcGUuXG5cbiAgICAgICAgbGV0IHNjb3BlID0gc2NvcGVNYW5hZ2VyLnNjb3Blc1swXTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnR5cGUpLnRvLmJlLmVxdWFsKCdnbG9iYWwnKTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnZhcmlhYmxlcykudG8uaGF2ZS5sZW5ndGgoMSk7ICAvLyBObyB2YXJpYWJsZSBpbiBQcm9ncmFtIHNjb3BlLlxuICAgICAgICBleHBlY3Qoc2NvcGUudmFyaWFibGVzWzBdLm5hbWUpLnRvLmJlLmVxdWFsKCdpJyk7XG5cbiAgICAgICAgc2NvcGUgPSBzY29wZU1hbmFnZXIuc2NvcGVzWzFdO1xuICAgICAgICBleHBlY3Qoc2NvcGUudHlwZSkudG8uYmUuZXF1YWwoJ2Jsb2NrJyk7XG4gICAgICAgIGV4cGVjdChzY29wZS52YXJpYWJsZXMpLnRvLmhhdmUubGVuZ3RoKDEpOyAgLy8gYGlgIGluIGJsb2NrIHNjb3BlLlxuICAgICAgICBleHBlY3Qoc2NvcGUudmFyaWFibGVzWzBdLm5hbWUpLnRvLmJlLmVxdWFsKCdpJyk7XG4gICAgICAgIGV4cGVjdChzY29wZS5yZWZlcmVuY2VzKS50by5oYXZlLmxlbmd0aCgzKTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnJlZmVyZW5jZXNbMF0uaWRlbnRpZmllci5uYW1lKS50by5iZS5lcXVhbCgnaScpO1xuICAgICAgICBleHBlY3Qoc2NvcGUucmVmZXJlbmNlc1sxXS5pZGVudGlmaWVyLm5hbWUpLnRvLmJlLmVxdWFsKCdpJyk7XG4gICAgICAgIGV4cGVjdChzY29wZS5yZWZlcmVuY2VzWzJdLmlkZW50aWZpZXIubmFtZSkudG8uYmUuZXF1YWwoJ2knKTtcbiAgICB9KTtcblxuICAgIGl0KCdmdW5jdGlvbiBkZWxhcmF0aW9uIGlzIG1hdGVyaWFsaXplZCBpbiBFUzYgYmxvY2sgc2NvcGUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3QgYXN0ID0gcGFyc2UoYFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHRlc3QoKSB7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRlc3QoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgYCk7XG5cbiAgICAgICAgY29uc3Qgc2NvcGVNYW5hZ2VyID0gYW5hbHl6ZShhc3QsIHtlY21hVmVyc2lvbjogNn0pO1xuICAgICAgICBleHBlY3Qoc2NvcGVNYW5hZ2VyLnNjb3BlcykudG8uaGF2ZS5sZW5ndGgoMyk7XG5cbiAgICAgICAgbGV0IHNjb3BlID0gc2NvcGVNYW5hZ2VyLnNjb3Blc1swXTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnR5cGUpLnRvLmJlLmVxdWFsKCdnbG9iYWwnKTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnZhcmlhYmxlcykudG8uaGF2ZS5sZW5ndGgoMCk7XG5cbiAgICAgICAgc2NvcGUgPSBzY29wZU1hbmFnZXIuc2NvcGVzWzFdO1xuICAgICAgICBleHBlY3Qoc2NvcGUudHlwZSkudG8uYmUuZXF1YWwoJ2Jsb2NrJyk7XG4gICAgICAgIGV4cGVjdChzY29wZS52YXJpYWJsZXMpLnRvLmhhdmUubGVuZ3RoKDEpO1xuICAgICAgICBleHBlY3Qoc2NvcGUudmFyaWFibGVzWzBdLm5hbWUpLnRvLmJlLmVxdWFsKCd0ZXN0Jyk7XG4gICAgICAgIGV4cGVjdChzY29wZS5yZWZlcmVuY2VzKS50by5oYXZlLmxlbmd0aCgxKTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnJlZmVyZW5jZXNbMF0uaWRlbnRpZmllci5uYW1lKS50by5iZS5lcXVhbCgndGVzdCcpO1xuXG4gICAgICAgIHNjb3BlID0gc2NvcGVNYW5hZ2VyLnNjb3Blc1syXTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnR5cGUpLnRvLmJlLmVxdWFsKCdmdW5jdGlvbicpO1xuICAgICAgICBleHBlY3Qoc2NvcGUudmFyaWFibGVzKS50by5oYXZlLmxlbmd0aCgxKTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnZhcmlhYmxlc1swXS5uYW1lKS50by5iZS5lcXVhbCgnYXJndW1lbnRzJyk7XG4gICAgICAgIGV4cGVjdChzY29wZS5yZWZlcmVuY2VzKS50by5oYXZlLmxlbmd0aCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdsZXQgaXMgbm90IGhvaXN0YWJsZSMxJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IGFzdCA9IHBhcnNlKGBcbiAgICAgICAgICAgIHZhciBpID0gNDI7ICgxKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGk7ICAvLyAoMikgUmVmZXJlbmNlRXJyb3IgYXQgcnVudGltZS5cbiAgICAgICAgICAgICAgICBsZXQgaSA9IDIwOyAgLy8gKDIpXG4gICAgICAgICAgICAgICAgaTsgIC8vICgyKVxuICAgICAgICAgICAgfVxuICAgICAgICBgKTtcblxuICAgICAgICBjb25zdCBzY29wZU1hbmFnZXIgPSBhbmFseXplKGFzdCwge2VjbWFWZXJzaW9uOiA2fSk7XG4gICAgICAgIGV4cGVjdChzY29wZU1hbmFnZXIuc2NvcGVzKS50by5oYXZlLmxlbmd0aCgyKTtcblxuICAgICAgICBjb25zdCBnbG9iYWxTY29wZSA9IHNjb3BlTWFuYWdlci5zY29wZXNbMF07XG4gICAgICAgIGV4cGVjdChnbG9iYWxTY29wZS50eXBlKS50by5iZS5lcXVhbCgnZ2xvYmFsJyk7XG4gICAgICAgIGV4cGVjdChnbG9iYWxTY29wZS52YXJpYWJsZXMpLnRvLmhhdmUubGVuZ3RoKDEpO1xuICAgICAgICBleHBlY3QoZ2xvYmFsU2NvcGUudmFyaWFibGVzWzBdLm5hbWUpLnRvLmJlLmVxdWFsKCdpJyk7XG4gICAgICAgIGV4cGVjdChnbG9iYWxTY29wZS5yZWZlcmVuY2VzKS50by5oYXZlLmxlbmd0aCgxKTtcblxuICAgICAgICBjb25zdCBzY29wZSA9IHNjb3BlTWFuYWdlci5zY29wZXNbMV07XG4gICAgICAgIGV4cGVjdChzY29wZS50eXBlKS50by5iZS5lcXVhbCgnYmxvY2snKTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnZhcmlhYmxlcykudG8uaGF2ZS5sZW5ndGgoMSk7XG4gICAgICAgIGV4cGVjdChzY29wZS52YXJpYWJsZXNbMF0ubmFtZSkudG8uYmUuZXF1YWwoJ2knKTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnJlZmVyZW5jZXMpLnRvLmhhdmUubGVuZ3RoKDMpO1xuICAgICAgICBleHBlY3Qoc2NvcGUucmVmZXJlbmNlc1swXS5yZXNvbHZlZCkudG8uYmUuZXF1YWwoc2NvcGUudmFyaWFibGVzWzBdKTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnJlZmVyZW5jZXNbMV0ucmVzb2x2ZWQpLnRvLmJlLmVxdWFsKHNjb3BlLnZhcmlhYmxlc1swXSk7XG4gICAgICAgIGV4cGVjdChzY29wZS5yZWZlcmVuY2VzWzJdLnJlc29sdmVkKS50by5iZS5lcXVhbChzY29wZS52YXJpYWJsZXNbMF0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2xldCBpcyBub3QgaG9pc3RhYmxlIzInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3QgYXN0ID0gcGFyc2UoYFxuICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgaSA9IDQyOyAvLyAoMSlcbiAgICAgICAgICAgICAgICBpOyAgLy8gKDEpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpOyAgLy8gKDMpXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGk7ICAvLyAoMilcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpID0gMjA7ICAvLyAoMilcbiAgICAgICAgICAgICAgICAgICAgICAgIGk7ICAvLyAoMilcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsZXQgaSA9IDMwOyAgLy8gKDMpXG4gICAgICAgICAgICAgICAgICAgIGk7ICAvLyAoMylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaTsgIC8vICgxKVxuICAgICAgICAgICAgfSgpKTtcbiAgICAgICAgYCk7XG5cbiAgICAgICAgY29uc3Qgc2NvcGVNYW5hZ2VyID0gYW5hbHl6ZShhc3QsIHtlY21hVmVyc2lvbjogNn0pO1xuICAgICAgICBleHBlY3Qoc2NvcGVNYW5hZ2VyLnNjb3BlcykudG8uaGF2ZS5sZW5ndGgoNCk7XG5cbiAgICAgICAgY29uc3QgZ2xvYmFsU2NvcGUgPSBzY29wZU1hbmFnZXIuc2NvcGVzWzBdO1xuICAgICAgICBleHBlY3QoZ2xvYmFsU2NvcGUudHlwZSkudG8uYmUuZXF1YWwoJ2dsb2JhbCcpO1xuICAgICAgICBleHBlY3QoZ2xvYmFsU2NvcGUudmFyaWFibGVzKS50by5oYXZlLmxlbmd0aCgwKTtcbiAgICAgICAgZXhwZWN0KGdsb2JhbFNjb3BlLnJlZmVyZW5jZXMpLnRvLmhhdmUubGVuZ3RoKDApO1xuXG4gICAgICAgIGxldCBzY29wZSA9IHNjb3BlTWFuYWdlci5zY29wZXNbMV07XG4gICAgICAgIGV4cGVjdChzY29wZS50eXBlKS50by5iZS5lcXVhbCgnZnVuY3Rpb24nKTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnZhcmlhYmxlcykudG8uaGF2ZS5sZW5ndGgoMik7XG4gICAgICAgIGV4cGVjdChzY29wZS52YXJpYWJsZXNbMF0ubmFtZSkudG8uYmUuZXF1YWwoJ2FyZ3VtZW50cycpO1xuICAgICAgICBleHBlY3Qoc2NvcGUudmFyaWFibGVzWzFdLm5hbWUpLnRvLmJlLmVxdWFsKCdpJyk7XG4gICAgICAgIGNvbnN0IHYxID0gc2NvcGUudmFyaWFibGVzWzFdO1xuICAgICAgICBleHBlY3Qoc2NvcGUucmVmZXJlbmNlcykudG8uaGF2ZS5sZW5ndGgoMyk7XG4gICAgICAgIGV4cGVjdChzY29wZS5yZWZlcmVuY2VzWzBdLnJlc29sdmVkKS50by5iZS5lcXVhbCh2MSk7XG4gICAgICAgIGV4cGVjdChzY29wZS5yZWZlcmVuY2VzWzFdLnJlc29sdmVkKS50by5iZS5lcXVhbCh2MSk7XG4gICAgICAgIGV4cGVjdChzY29wZS5yZWZlcmVuY2VzWzJdLnJlc29sdmVkKS50by5iZS5lcXVhbCh2MSk7XG5cbiAgICAgICAgc2NvcGUgPSBzY29wZU1hbmFnZXIuc2NvcGVzWzJdO1xuICAgICAgICBleHBlY3Qoc2NvcGUudHlwZSkudG8uYmUuZXF1YWwoJ2Jsb2NrJyk7XG4gICAgICAgIGV4cGVjdChzY29wZS52YXJpYWJsZXMpLnRvLmhhdmUubGVuZ3RoKDEpO1xuICAgICAgICBleHBlY3Qoc2NvcGUudmFyaWFibGVzWzBdLm5hbWUpLnRvLmJlLmVxdWFsKCdpJyk7XG4gICAgICAgIGNvbnN0IHYzID0gc2NvcGUudmFyaWFibGVzWzBdO1xuICAgICAgICBleHBlY3Qoc2NvcGUucmVmZXJlbmNlcykudG8uaGF2ZS5sZW5ndGgoMyk7XG4gICAgICAgIGV4cGVjdChzY29wZS5yZWZlcmVuY2VzWzBdLnJlc29sdmVkKS50by5iZS5lcXVhbCh2Myk7XG4gICAgICAgIGV4cGVjdChzY29wZS5yZWZlcmVuY2VzWzFdLnJlc29sdmVkKS50by5iZS5lcXVhbCh2Myk7XG4gICAgICAgIGV4cGVjdChzY29wZS5yZWZlcmVuY2VzWzJdLnJlc29sdmVkKS50by5iZS5lcXVhbCh2Myk7XG5cbiAgICAgICAgc2NvcGUgPSBzY29wZU1hbmFnZXIuc2NvcGVzWzNdO1xuICAgICAgICBleHBlY3Qoc2NvcGUudHlwZSkudG8uYmUuZXF1YWwoJ2Jsb2NrJyk7XG4gICAgICAgIGV4cGVjdChzY29wZS52YXJpYWJsZXMpLnRvLmhhdmUubGVuZ3RoKDEpO1xuICAgICAgICBleHBlY3Qoc2NvcGUudmFyaWFibGVzWzBdLm5hbWUpLnRvLmJlLmVxdWFsKCdpJyk7XG4gICAgICAgIGNvbnN0IHYyID0gc2NvcGUudmFyaWFibGVzWzBdO1xuICAgICAgICBleHBlY3Qoc2NvcGUucmVmZXJlbmNlcykudG8uaGF2ZS5sZW5ndGgoMyk7XG4gICAgICAgIGV4cGVjdChzY29wZS5yZWZlcmVuY2VzWzBdLnJlc29sdmVkKS50by5iZS5lcXVhbCh2Mik7XG4gICAgICAgIGV4cGVjdChzY29wZS5yZWZlcmVuY2VzWzFdLnJlc29sdmVkKS50by5iZS5lcXVhbCh2Mik7XG4gICAgICAgIGV4cGVjdChzY29wZS5yZWZlcmVuY2VzWzJdLnJlc29sdmVkKS50by5iZS5lcXVhbCh2Mik7XG4gICAgfSk7XG59KTtcblxuLy8gdmltOiBzZXQgc3c9NCB0cz00IGV0IHR3PTgwIDpcbiJdfQ==
