'use strict';

var _chai = require('chai');

var _esprima = require('../third_party/esprima');

var _ = require('..');

describe('ES6 catch', function () {
    it('takes binding pattern', function () {
        var ast = (0, _esprima.parse)('\n            try {\n            } catch ({ a, b, c, d }) {\n                let e = 20;\n                a;\n                b;\n                let c = 30;\n                c;\n                d;\n            }\n        ');

        var scopeManager = (0, _.analyze)(ast, { ecmaVersion: 6 });
        (0, _chai.expect)(scopeManager.scopes).to.have.length(4);

        var scope = scopeManager.scopes[0];
        (0, _chai.expect)(scope.type).to.be.equal('global');
        (0, _chai.expect)(scope.block.type).to.be.equal('Program');
        (0, _chai.expect)(scope.isStrict).to.be.false;
        (0, _chai.expect)(scope.variables).to.have.length(0);
        (0, _chai.expect)(scope.references).to.have.length(0);

        scope = scopeManager.scopes[1];
        (0, _chai.expect)(scope.type).to.be.equal('block');
        (0, _chai.expect)(scope.block.type).to.be.equal('BlockStatement');
        (0, _chai.expect)(scope.isStrict).to.be.false;
        (0, _chai.expect)(scope.variables).to.have.length(0);
        (0, _chai.expect)(scope.references).to.have.length(0);

        scope = scopeManager.scopes[2];
        (0, _chai.expect)(scope.type).to.be.equal('catch');
        (0, _chai.expect)(scope.block.type).to.be.equal('CatchClause');
        (0, _chai.expect)(scope.isStrict).to.be.false;

        // FIXME After Esprima's bug is fixed, I'll add tests #33
        // https://github.com/estools/escope/issues/33#issuecomment-64135832
        //
        // expect(scope.variables).to.have.length(4);
        // expect(scope.variables[0].name).to.be.equal('a');
        // expect(scope.variables[1].name).to.be.equal('b');
        // expect(scope.variables[2].name).to.be.equal('c');
        // expect(scope.variables[3].name).to.be.equal('d');
        // expect(scope.references).to.have.length(0);

        scope = scopeManager.scopes[3];
        (0, _chai.expect)(scope.type).to.be.equal('block');
        (0, _chai.expect)(scope.block.type).to.be.equal('BlockStatement');
        (0, _chai.expect)(scope.isStrict).to.be.false;
        (0, _chai.expect)(scope.variables).to.have.length(2);
        (0, _chai.expect)(scope.variables.map(function (variable) {
            return variable.name;
        })).to.be.eql(['e', 'c']);
        (0, _chai.expect)(scope.references.map(function (ref) {
            return ref.identifier.name;
        })).to.be.eql(['e', 'a', 'b', 'c', 'c', 'd']);
    });
});

// vim: set sw=4 ts=4 et tw=80 :
// -*- coding: utf-8 -*-
//  Copyright (C) 2014 Yusuke Suzuki <utatane.tea@gmail.com>
//
//  Redistribution and use in source and binary forms, with or without
//  modification, are permitted provided that the following conditions are met:
//
//    * Redistributions of source code must retain the above copyright
//      notice, this list of conditions and the following disclaimer.
//    * Redistributions in binary form must reproduce the above copyright
//      notice, this list of conditions and the following disclaimer in the
//      documentation and/or other materials provided with the distribution.
//
//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
//  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
//  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
//  ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY
//  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
//  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
//  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
//  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
//  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
//  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVzNi1jYXRjaC5qcyJdLCJuYW1lcyI6WyJkZXNjcmliZSIsIml0IiwiYXN0Iiwic2NvcGVNYW5hZ2VyIiwiZWNtYVZlcnNpb24iLCJzY29wZXMiLCJ0byIsImhhdmUiLCJsZW5ndGgiLCJzY29wZSIsInR5cGUiLCJiZSIsImVxdWFsIiwiYmxvY2siLCJpc1N0cmljdCIsImZhbHNlIiwidmFyaWFibGVzIiwicmVmZXJlbmNlcyIsIm1hcCIsInZhcmlhYmxlIiwibmFtZSIsImVxbCIsInJlZiIsImlkZW50aWZpZXIiXSwibWFwcGluZ3MiOiI7O0FBc0JBOztBQUNBOztBQUNBOztBQUVBQSxTQUFTLFdBQVQsRUFBc0IsWUFBVztBQUM3QkMsT0FBRyx1QkFBSCxFQUE0QixZQUFXO0FBQ25DLFlBQU1DLE1BQU0scVBBQVo7O0FBWUEsWUFBTUMsZUFBZSxlQUFRRCxHQUFSLEVBQWEsRUFBQ0UsYUFBYSxDQUFkLEVBQWIsQ0FBckI7QUFDQSwwQkFBT0QsYUFBYUUsTUFBcEIsRUFBNEJDLEVBQTVCLENBQStCQyxJQUEvQixDQUFvQ0MsTUFBcEMsQ0FBMkMsQ0FBM0M7O0FBRUEsWUFBSUMsUUFBUU4sYUFBYUUsTUFBYixDQUFvQixDQUFwQixDQUFaO0FBQ0EsMEJBQU9JLE1BQU1DLElBQWIsRUFBbUJKLEVBQW5CLENBQXNCSyxFQUF0QixDQUF5QkMsS0FBekIsQ0FBK0IsUUFBL0I7QUFDQSwwQkFBT0gsTUFBTUksS0FBTixDQUFZSCxJQUFuQixFQUF5QkosRUFBekIsQ0FBNEJLLEVBQTVCLENBQStCQyxLQUEvQixDQUFxQyxTQUFyQztBQUNBLDBCQUFPSCxNQUFNSyxRQUFiLEVBQXVCUixFQUF2QixDQUEwQkssRUFBMUIsQ0FBNkJJLEtBQTdCO0FBQ0EsMEJBQU9OLE1BQU1PLFNBQWIsRUFBd0JWLEVBQXhCLENBQTJCQyxJQUEzQixDQUFnQ0MsTUFBaEMsQ0FBdUMsQ0FBdkM7QUFDQSwwQkFBT0MsTUFBTVEsVUFBYixFQUF5QlgsRUFBekIsQ0FBNEJDLElBQTVCLENBQWlDQyxNQUFqQyxDQUF3QyxDQUF4Qzs7QUFFQUMsZ0JBQVFOLGFBQWFFLE1BQWIsQ0FBb0IsQ0FBcEIsQ0FBUjtBQUNBLDBCQUFPSSxNQUFNQyxJQUFiLEVBQW1CSixFQUFuQixDQUFzQkssRUFBdEIsQ0FBeUJDLEtBQXpCLENBQStCLE9BQS9CO0FBQ0EsMEJBQU9ILE1BQU1JLEtBQU4sQ0FBWUgsSUFBbkIsRUFBeUJKLEVBQXpCLENBQTRCSyxFQUE1QixDQUErQkMsS0FBL0IsQ0FBcUMsZ0JBQXJDO0FBQ0EsMEJBQU9ILE1BQU1LLFFBQWIsRUFBdUJSLEVBQXZCLENBQTBCSyxFQUExQixDQUE2QkksS0FBN0I7QUFDQSwwQkFBT04sTUFBTU8sU0FBYixFQUF3QlYsRUFBeEIsQ0FBMkJDLElBQTNCLENBQWdDQyxNQUFoQyxDQUF1QyxDQUF2QztBQUNBLDBCQUFPQyxNQUFNUSxVQUFiLEVBQXlCWCxFQUF6QixDQUE0QkMsSUFBNUIsQ0FBaUNDLE1BQWpDLENBQXdDLENBQXhDOztBQUVBQyxnQkFBUU4sYUFBYUUsTUFBYixDQUFvQixDQUFwQixDQUFSO0FBQ0EsMEJBQU9JLE1BQU1DLElBQWIsRUFBbUJKLEVBQW5CLENBQXNCSyxFQUF0QixDQUF5QkMsS0FBekIsQ0FBK0IsT0FBL0I7QUFDQSwwQkFBT0gsTUFBTUksS0FBTixDQUFZSCxJQUFuQixFQUF5QkosRUFBekIsQ0FBNEJLLEVBQTVCLENBQStCQyxLQUEvQixDQUFxQyxhQUFyQztBQUNBLDBCQUFPSCxNQUFNSyxRQUFiLEVBQXVCUixFQUF2QixDQUEwQkssRUFBMUIsQ0FBNkJJLEtBQTdCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQU4sZ0JBQVFOLGFBQWFFLE1BQWIsQ0FBb0IsQ0FBcEIsQ0FBUjtBQUNBLDBCQUFPSSxNQUFNQyxJQUFiLEVBQW1CSixFQUFuQixDQUFzQkssRUFBdEIsQ0FBeUJDLEtBQXpCLENBQStCLE9BQS9CO0FBQ0EsMEJBQU9ILE1BQU1JLEtBQU4sQ0FBWUgsSUFBbkIsRUFBeUJKLEVBQXpCLENBQTRCSyxFQUE1QixDQUErQkMsS0FBL0IsQ0FBcUMsZ0JBQXJDO0FBQ0EsMEJBQU9ILE1BQU1LLFFBQWIsRUFBdUJSLEVBQXZCLENBQTBCSyxFQUExQixDQUE2QkksS0FBN0I7QUFDQSwwQkFBT04sTUFBTU8sU0FBYixFQUF3QlYsRUFBeEIsQ0FBMkJDLElBQTNCLENBQWdDQyxNQUFoQyxDQUF1QyxDQUF2QztBQUNBLDBCQUFPQyxNQUFNTyxTQUFOLENBQWdCRSxHQUFoQixDQUFvQjtBQUFBLG1CQUFZQyxTQUFTQyxJQUFyQjtBQUFBLFNBQXBCLENBQVAsRUFBdURkLEVBQXZELENBQTBESyxFQUExRCxDQUE2RFUsR0FBN0QsQ0FBaUUsQ0FDN0QsR0FENkQsRUFFN0QsR0FGNkQsQ0FBakU7QUFJQSwwQkFBT1osTUFBTVEsVUFBTixDQUFpQkMsR0FBakIsQ0FBcUI7QUFBQSxtQkFBT0ksSUFBSUMsVUFBSixDQUFlSCxJQUF0QjtBQUFBLFNBQXJCLENBQVAsRUFBeURkLEVBQXpELENBQTRESyxFQUE1RCxDQUErRFUsR0FBL0QsQ0FBbUUsQ0FDL0QsR0FEK0QsRUFFL0QsR0FGK0QsRUFHL0QsR0FIK0QsRUFJL0QsR0FKK0QsRUFLL0QsR0FMK0QsRUFNL0QsR0FOK0QsQ0FBbkU7QUFRSCxLQTlERDtBQStESCxDQWhFRDs7QUFrRUE7QUE1RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZXM2LWNhdGNoLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gLSotIGNvZGluZzogdXRmLTggLSotXG4vLyAgQ29weXJpZ2h0IChDKSAyMDE0IFl1c3VrZSBTdXp1a2kgPHV0YXRhbmUudGVhQGdtYWlsLmNvbT5cbi8vXG4vLyAgUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0XG4vLyAgbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6XG4vL1xuLy8gICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodFxuLy8gICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuXG4vLyAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0XG4vLyAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGVcbi8vICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi5cbi8vXG4vLyAgVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyBcIkFTIElTXCJcbi8vICBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFXG4vLyAgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0Vcbi8vICBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgPENPUFlSSUdIVCBIT0xERVI+IEJFIExJQUJMRSBGT1IgQU5ZXG4vLyAgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVNcbi8vICAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7XG4vLyAgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EXG4vLyAgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlRcbi8vICAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0Zcbi8vICBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuaW1wb3J0IHsgZXhwZWN0IH0gZnJvbSAnY2hhaSc7XG5pbXBvcnQgeyBwYXJzZSB9IGZyb20gJy4uL3RoaXJkX3BhcnR5L2VzcHJpbWEnO1xuaW1wb3J0IHsgYW5hbHl6ZSB9IGZyb20gJy4uJztcblxuZGVzY3JpYmUoJ0VTNiBjYXRjaCcsIGZ1bmN0aW9uKCkge1xuICAgIGl0KCd0YWtlcyBiaW5kaW5nIHBhdHRlcm4nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3QgYXN0ID0gcGFyc2UoYFxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIH0gY2F0Y2ggKHsgYSwgYiwgYywgZCB9KSB7XG4gICAgICAgICAgICAgICAgbGV0IGUgPSAyMDtcbiAgICAgICAgICAgICAgICBhO1xuICAgICAgICAgICAgICAgIGI7XG4gICAgICAgICAgICAgICAgbGV0IGMgPSAzMDtcbiAgICAgICAgICAgICAgICBjO1xuICAgICAgICAgICAgICAgIGQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIGApO1xuXG4gICAgICAgIGNvbnN0IHNjb3BlTWFuYWdlciA9IGFuYWx5emUoYXN0LCB7ZWNtYVZlcnNpb246IDZ9KTtcbiAgICAgICAgZXhwZWN0KHNjb3BlTWFuYWdlci5zY29wZXMpLnRvLmhhdmUubGVuZ3RoKDQpO1xuXG4gICAgICAgIGxldCBzY29wZSA9IHNjb3BlTWFuYWdlci5zY29wZXNbMF07XG4gICAgICAgIGV4cGVjdChzY29wZS50eXBlKS50by5iZS5lcXVhbCgnZ2xvYmFsJyk7XG4gICAgICAgIGV4cGVjdChzY29wZS5ibG9jay50eXBlKS50by5iZS5lcXVhbCgnUHJvZ3JhbScpO1xuICAgICAgICBleHBlY3Qoc2NvcGUuaXNTdHJpY3QpLnRvLmJlLmZhbHNlO1xuICAgICAgICBleHBlY3Qoc2NvcGUudmFyaWFibGVzKS50by5oYXZlLmxlbmd0aCgwKTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnJlZmVyZW5jZXMpLnRvLmhhdmUubGVuZ3RoKDApO1xuXG4gICAgICAgIHNjb3BlID0gc2NvcGVNYW5hZ2VyLnNjb3Blc1sxXTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnR5cGUpLnRvLmJlLmVxdWFsKCdibG9jaycpO1xuICAgICAgICBleHBlY3Qoc2NvcGUuYmxvY2sudHlwZSkudG8uYmUuZXF1YWwoJ0Jsb2NrU3RhdGVtZW50Jyk7XG4gICAgICAgIGV4cGVjdChzY29wZS5pc1N0cmljdCkudG8uYmUuZmFsc2U7XG4gICAgICAgIGV4cGVjdChzY29wZS52YXJpYWJsZXMpLnRvLmhhdmUubGVuZ3RoKDApO1xuICAgICAgICBleHBlY3Qoc2NvcGUucmVmZXJlbmNlcykudG8uaGF2ZS5sZW5ndGgoMCk7XG5cbiAgICAgICAgc2NvcGUgPSBzY29wZU1hbmFnZXIuc2NvcGVzWzJdO1xuICAgICAgICBleHBlY3Qoc2NvcGUudHlwZSkudG8uYmUuZXF1YWwoJ2NhdGNoJyk7XG4gICAgICAgIGV4cGVjdChzY29wZS5ibG9jay50eXBlKS50by5iZS5lcXVhbCgnQ2F0Y2hDbGF1c2UnKTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLmlzU3RyaWN0KS50by5iZS5mYWxzZTtcblxuICAgICAgICAvLyBGSVhNRSBBZnRlciBFc3ByaW1hJ3MgYnVnIGlzIGZpeGVkLCBJJ2xsIGFkZCB0ZXN0cyAjMzNcbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2VzdG9vbHMvZXNjb3BlL2lzc3Vlcy8zMyNpc3N1ZWNvbW1lbnQtNjQxMzU4MzJcbiAgICAgICAgLy9cbiAgICAgICAgLy8gZXhwZWN0KHNjb3BlLnZhcmlhYmxlcykudG8uaGF2ZS5sZW5ndGgoNCk7XG4gICAgICAgIC8vIGV4cGVjdChzY29wZS52YXJpYWJsZXNbMF0ubmFtZSkudG8uYmUuZXF1YWwoJ2EnKTtcbiAgICAgICAgLy8gZXhwZWN0KHNjb3BlLnZhcmlhYmxlc1sxXS5uYW1lKS50by5iZS5lcXVhbCgnYicpO1xuICAgICAgICAvLyBleHBlY3Qoc2NvcGUudmFyaWFibGVzWzJdLm5hbWUpLnRvLmJlLmVxdWFsKCdjJyk7XG4gICAgICAgIC8vIGV4cGVjdChzY29wZS52YXJpYWJsZXNbM10ubmFtZSkudG8uYmUuZXF1YWwoJ2QnKTtcbiAgICAgICAgLy8gZXhwZWN0KHNjb3BlLnJlZmVyZW5jZXMpLnRvLmhhdmUubGVuZ3RoKDApO1xuXG4gICAgICAgIHNjb3BlID0gc2NvcGVNYW5hZ2VyLnNjb3Blc1szXTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnR5cGUpLnRvLmJlLmVxdWFsKCdibG9jaycpO1xuICAgICAgICBleHBlY3Qoc2NvcGUuYmxvY2sudHlwZSkudG8uYmUuZXF1YWwoJ0Jsb2NrU3RhdGVtZW50Jyk7XG4gICAgICAgIGV4cGVjdChzY29wZS5pc1N0cmljdCkudG8uYmUuZmFsc2U7XG4gICAgICAgIGV4cGVjdChzY29wZS52YXJpYWJsZXMpLnRvLmhhdmUubGVuZ3RoKDIpO1xuICAgICAgICBleHBlY3Qoc2NvcGUudmFyaWFibGVzLm1hcCh2YXJpYWJsZSA9PiB2YXJpYWJsZS5uYW1lKSkudG8uYmUuZXFsKFtcbiAgICAgICAgICAgICdlJyxcbiAgICAgICAgICAgICdjJ1xuICAgICAgICBdKTtcbiAgICAgICAgZXhwZWN0KHNjb3BlLnJlZmVyZW5jZXMubWFwKHJlZiA9PiByZWYuaWRlbnRpZmllci5uYW1lKSkudG8uYmUuZXFsKFtcbiAgICAgICAgICAgICdlJyxcbiAgICAgICAgICAgICdhJyxcbiAgICAgICAgICAgICdiJyxcbiAgICAgICAgICAgICdjJyxcbiAgICAgICAgICAgICdjJyxcbiAgICAgICAgICAgICdkJ1xuICAgICAgICBdKTtcbiAgICB9KTtcbn0pO1xuXG4vLyB2aW06IHNldCBzdz00IHRzPTQgZXQgdHc9ODAgOlxuIl19
