'use strict';

var _chai = require('chai');

var _ = require('..');

var _esprima = require('esprima');

describe('optimistic', function () {
    it('direct call to eval', function () {
        var ast = (0, _esprima.parse)('\n            function outer() {\n                eval(str);\n                var i = 20;\n                function inner() {\n                    i;\n                }\n            }\n        ');

        var _analyze = (0, _.analyze)(ast, { optimistic: true });

        var scopes = _analyze.scopes;


        (0, _chai.expect)(scopes.map(function (scope) {
            return scope.variables.map(function (variable) {
                return variable.name;
            });
        })).to.be.eql([['outer'], ['arguments', 'i', 'inner'], ['arguments']]);
    });

    it('with statement', function () {
        var ast = (0, _esprima.parse)('\n            function outer() {\n                eval(str);\n                var i = 20;\n                with (obj) {\n                    i;\n                }\n            }\n        ');

        var _analyze2 = (0, _.analyze)(ast, { optimistic: true });

        var scopes = _analyze2.scopes;


        (0, _chai.expect)(scopes.map(function (scope) {
            return scope.variables.map(function (variable) {
                return variable.name;
            });
        })).to.be.eql([['outer'], ['arguments', 'i'], []]);
    });
}); // Copyright (C) 2013 Yusuke Suzuki <utatane.tea@gmail.com>
//
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are met:
//
//   * Redistributions of source code must retain the above copyright
//     notice, this list of conditions and the following disclaimer.
//   * Redistributions in binary form must reproduce the above copyright
//     notice, this list of conditions and the following disclaimer in the
//     documentation and/or other materials provided with the distribution.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
// AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
// ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY
// DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
// (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
// LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
// ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
// THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9wdGltaXN0aWMuanMiXSwibmFtZXMiOlsiZGVzY3JpYmUiLCJpdCIsImFzdCIsIm9wdGltaXN0aWMiLCJzY29wZXMiLCJtYXAiLCJzY29wZSIsInZhcmlhYmxlcyIsInZhcmlhYmxlIiwibmFtZSIsInRvIiwiYmUiLCJlcWwiXSwibWFwcGluZ3MiOiI7O0FBdUJBOztBQUNBOztBQUNBOztBQUVBQSxTQUFTLFlBQVQsRUFBdUIsWUFBVztBQUM5QkMsT0FBRyxxQkFBSCxFQUEwQixZQUFXO0FBQ2pDLFlBQU1DLE1BQU0sd05BQVo7O0FBRGlDLHVCQVdkLGVBQVFBLEdBQVIsRUFBYSxFQUFDQyxZQUFZLElBQWIsRUFBYixDQVhjOztBQUFBLFlBV3pCQyxNQVh5QixZQVd6QkEsTUFYeUI7OztBQWFqQywwQkFBT0EsT0FBT0MsR0FBUCxDQUFXO0FBQUEsbUJBQVNDLE1BQU1DLFNBQU4sQ0FBZ0JGLEdBQWhCLENBQW9CO0FBQUEsdUJBQVlHLFNBQVNDLElBQXJCO0FBQUEsYUFBcEIsQ0FBVDtBQUFBLFNBQVgsQ0FBUCxFQUE0RUMsRUFBNUUsQ0FBK0VDLEVBQS9FLENBQWtGQyxHQUFsRixDQUNJLENBQ0ksQ0FDSSxPQURKLENBREosRUFJSSxDQUNJLFdBREosRUFFSSxHQUZKLEVBR0ksT0FISixDQUpKLEVBU0ksQ0FDSSxXQURKLENBVEosQ0FESjtBQWVILEtBNUJEOztBQThCQVgsT0FBRyxnQkFBSCxFQUFxQixZQUFXO0FBQzVCLFlBQU1DLE1BQU0sa05BQVo7O0FBRDRCLHdCQVdULGVBQVFBLEdBQVIsRUFBYSxFQUFDQyxZQUFZLElBQWIsRUFBYixDQVhTOztBQUFBLFlBV3BCQyxNQVhvQixhQVdwQkEsTUFYb0I7OztBQWE1QiwwQkFBT0EsT0FBT0MsR0FBUCxDQUFXO0FBQUEsbUJBQVNDLE1BQU1DLFNBQU4sQ0FBZ0JGLEdBQWhCLENBQW9CO0FBQUEsdUJBQVlHLFNBQVNDLElBQXJCO0FBQUEsYUFBcEIsQ0FBVDtBQUFBLFNBQVgsQ0FBUCxFQUE0RUMsRUFBNUUsQ0FBK0VDLEVBQS9FLENBQWtGQyxHQUFsRixDQUNJLENBQ0ksQ0FDSSxPQURKLENBREosRUFJSSxDQUNJLFdBREosRUFFSSxHQUZKLENBSkosRUFRSSxFQVJKLENBREo7QUFhSCxLQTFCRDtBQTJCSCxDQTFERCxFLENBM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJvcHRpbWlzdGljLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChDKSAyMDEzIFl1c3VrZSBTdXp1a2kgPHV0YXRhbmUudGVhQGdtYWlsLmNvbT5cbi8vXG4vLyBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXRcbi8vIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OlxuLy9cbi8vICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodFxuLy8gICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbi8vICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodFxuLy8gICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGVcbi8vICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuLy9cbi8vIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBUyBJU1wiXG4vLyBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFXG4vLyBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRVxuLy8gQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIDxDT1BZUklHSFQgSE9MREVSPiBCRSBMSUFCTEUgRk9SIEFOWVxuLy8gRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVNcbi8vIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUztcbi8vIExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORFxuLy8gT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlRcbi8vIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRlxuLy8gVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS5cblxuXG5pbXBvcnQgeyBleHBlY3QgfSBmcm9tICdjaGFpJztcbmltcG9ydCB7IGFuYWx5emUgfSBmcm9tICcuLic7XG5pbXBvcnQgeyBwYXJzZSB9IGZyb20gJ2VzcHJpbWEnO1xuXG5kZXNjcmliZSgnb3B0aW1pc3RpYycsIGZ1bmN0aW9uKCkge1xuICAgIGl0KCdkaXJlY3QgY2FsbCB0byBldmFsJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IGFzdCA9IHBhcnNlKGBcbiAgICAgICAgICAgIGZ1bmN0aW9uIG91dGVyKCkge1xuICAgICAgICAgICAgICAgIGV2YWwoc3RyKTtcbiAgICAgICAgICAgICAgICB2YXIgaSA9IDIwO1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGlubmVyKCkge1xuICAgICAgICAgICAgICAgICAgICBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgYCk7XG5cbiAgICAgICAgY29uc3QgeyBzY29wZXMgfSA9IGFuYWx5emUoYXN0LCB7b3B0aW1pc3RpYzogdHJ1ZX0pO1xuXG4gICAgICAgIGV4cGVjdChzY29wZXMubWFwKHNjb3BlID0+IHNjb3BlLnZhcmlhYmxlcy5tYXAodmFyaWFibGUgPT4gdmFyaWFibGUubmFtZSkpKS50by5iZS5lcWwoXG4gICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICAnb3V0ZXInXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICAgICdhcmd1bWVudHMnLFxuICAgICAgICAgICAgICAgICAgICAnaScsXG4gICAgICAgICAgICAgICAgICAgICdpbm5lcidcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgJ2FyZ3VtZW50cydcbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICBdXG4gICAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnd2l0aCBzdGF0ZW1lbnQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3QgYXN0ID0gcGFyc2UoYFxuICAgICAgICAgICAgZnVuY3Rpb24gb3V0ZXIoKSB7XG4gICAgICAgICAgICAgICAgZXZhbChzdHIpO1xuICAgICAgICAgICAgICAgIHZhciBpID0gMjA7XG4gICAgICAgICAgICAgICAgd2l0aCAob2JqKSB7XG4gICAgICAgICAgICAgICAgICAgIGk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICBgKTtcblxuICAgICAgICBjb25zdCB7IHNjb3BlcyB9ID0gYW5hbHl6ZShhc3QsIHtvcHRpbWlzdGljOiB0cnVlfSk7XG5cbiAgICAgICAgZXhwZWN0KHNjb3Blcy5tYXAoc2NvcGUgPT4gc2NvcGUudmFyaWFibGVzLm1hcCh2YXJpYWJsZSA9PiB2YXJpYWJsZS5uYW1lKSkpLnRvLmJlLmVxbChcbiAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICAgICdvdXRlcidcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgJ2FyZ3VtZW50cycsXG4gICAgICAgICAgICAgICAgICAgICdpJ1xuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIF1cbiAgICAgICAgKTtcbiAgICB9KTtcbn0pO1xuIl19
